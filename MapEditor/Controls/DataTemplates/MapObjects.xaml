<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:MapEditor"
                    xmlns:controls="clr-namespace:MapEditor.Controls"
                    xmlns:models="clr-namespace:MapEditor.Models"
                    xmlns:enums="clr-namespace:MapEditor.Models.Elements.Enums"
                    xmlns:converters="clr-namespace:MapEditor.Core.Converters"
                    xmlns:validationrules="clr-namespace:MapEditor.Core.ValidationRules"
                    xmlns:markup="clr-namespace:MapEditor.Core.MarkupExtensions">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/MapEditor;component/Controls/IconResources.xaml" />
        <ResourceDictionary Source="/MapEditor;component/Controls/Styles.xaml" />
    </ResourceDictionary.MergedDictionaries>

    <DataTemplate DataType="{x:Type models:MapMystery}">
        <StackPanel HorizontalAlignment="Stretch"
                    Orientation="Vertical">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="Color:"/>
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding Source={markup:EnumBindingSourceExtension {x:Type enums:MysteryTypeNumber}}}"
                          SelectedItem="{Binding Type, Converter={StaticResource EnumToIntegerValueConverter}, ConverterParameter={x:Type enums:MysteryTypeNumber}}" />
            </Grid>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="Flag:"/>
                <controls:WheelCaptureIntegerUpDown Grid.Column="1" Minimum="0" DefaultValue="599" Height="22">
                    <controls:WheelCaptureIntegerUpDown.Text>
                        <Binding Path="Flag" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                            <Binding.ValidationRules>
                                <validationrules:MinMaxValidationRule Minimum="1" Maximum="599" ValidationStep="RawProposedValue"/>
                            </Binding.ValidationRules>
                        </Binding>
                    </controls:WheelCaptureIntegerUpDown.Text>
                </controls:WheelCaptureIntegerUpDown>
            </Grid>
            <TextBlock Text="Mystery Data:" FontWeight="Bold" />
            <Grid>
                <StackPanel Grid.IsSharedSizeScope="True"
                            Orientation="Vertical"
                            Margin="10,0,0,0"
                            DataContext="{Binding BaseMystery}">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding DataContext.Type, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=StackPanel}}" Value="0">
                                    <Setter Property="Visibility" Value="Hidden" />
                                </DataTrigger>
                            </Style.Triggers>
                            <Setter Property="Visibility" Value="Visible" />
                        </Style>
                    </StackPanel.Style>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                                   VerticalAlignment="Center"
                                   Text="Category:" />
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding Source={markup:EnumBindingSourceExtension {x:Type enums:ItemTypeNumber}}}"
                                  SelectedItem="{Binding Category, Converter={StaticResource EnumToIntegerValueConverter}, ConverterParameter={x:Type enums:ItemTypeNumber}, Delay=100}" />
                    </Grid>
                    <ContentControl>
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Category}" Value="0">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <StackPanel HorizontalAlignment="Stretch"
                                                            Orientation="Vertical">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center"
                                                                   Text="ID:"/>
                                                        <ComboBox Grid.Column="1"
                                                                  ItemsSource="{Binding Values, Source={x:Static local:Constants.ChipDefinitions}}"
                                                                  SelectedItem="{Binding Chip, Converter={StaticResource ChipToChipDefinitionConverter}, Mode=TwoWay}">
                                                            <ComboBox.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock Text="{Binding Name}" Margin="0,0,10,0" />
                                                                        <TextBlock>
                                                                            <TextBlock.Text>
                                                                                <MultiBinding Converter="{StaticResource ChipCodesMultiConverter}">
                                                                                    <Binding Path="Codes" />
                                                                                    <Binding Source="{x:Null}" />
                                                                                </MultiBinding>
                                                                            </TextBlock.Text>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ComboBox.ItemTemplate>
                                                        </ComboBox>
                                                    </Grid>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center"
                                                                   Text="Code:" />
                                                        <ComboBox Grid.Column="1"
                                                                  ItemsSource="{Binding Chip, Converter={StaticResource ChipToDistinctCodesConverter}}"
                                                                  SelectedValue="{Binding Data, Mode=TwoWay}"
                                                                  SelectedValuePath="Item1"
                                                                  DisplayMemberPath="Item2"/>
                                                    </Grid>
                                                </StackPanel>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Category}" Value="1">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <StackPanel HorizontalAlignment="Stretch"
                                                            Orientation="Vertical">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center"
                                                                   Text="Type:"/>
                                                        <ComboBox Grid.Column="1"
                                                                  ItemsSource="{Binding Source={markup:EnumBindingSourceExtension {x:Type enums:SubChipTypeNumber}}}"
                                                                  SelectedItem="{Binding ID, Converter={StaticResource EnumToIntegerValueConverter}, ConverterParameter={x:Type enums:SubChipTypeNumber}}" />

                                                    </Grid>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center"
                                                                   Text="N/A:"/>
                                                        <Border Grid.Column="1"
                                                                Height="22">
                                                            <TextBlock VerticalAlignment="Center"
                                                                       HorizontalAlignment="Center"
                                                                       Text="Not used for this item"/>
                                                        </Border>
                                                    </Grid>
                                                </StackPanel>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Category}" Value="2">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <StackPanel HorizontalAlignment="Stretch"
                                                            Orientation="Vertical">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                    VerticalAlignment="Center"
                                                                    Text="ID:"/>
                                                        <ComboBox Grid.Column="1"
                                                                  ItemsSource="{Binding Values, Source={x:Static local:Constants.AddOnDefinitions}}"
                                                                  SelectedItem="{Binding ID, Converter={StaticResource AddOnIDToAddOnDefinitionConverter}, Mode=TwoWay}"
                                                                  DisplayMemberPath="Name"/>

                                                    </Grid>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center"
                                                                   Text="Color:" />
                                                        <ComboBox Grid.Column="1"
                                                                  ItemsSource="{Binding Source={markup:EnumBindingSourceExtension {x:Type enums:ProgramColorTypeNumber}}}"
                                                                  SelectedItem="{Binding Data, Converter={StaticResource EnumToIntegerValueConverter}, ConverterParameter={x:Type enums:ProgramColorTypeNumber}}" />
                                                    </Grid>
                                                </StackPanel>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Category}" Value="3">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <StackPanel HorizontalAlignment="Stretch"
                                                            Orientation="Vertical">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center"
                                                                   Text="Type:" />
                                                        <ComboBox Grid.Column="1"
                                                                  ItemsSource="{Binding Source={markup:EnumBindingSourceExtension {x:Type enums:OtherItemTypeNumber}}}"
                                                                  SelectedItem="{Binding ID, Converter={StaticResource EnumToIntegerValueConverter}, ConverterParameter={x:Type enums:OtherItemTypeNumber}}" />
                                                    </Grid>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MysteryLabelColumn" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center" Text="Amount:" />
                                                        <ContentControl Grid.Column="1">
                                                            <ContentControl.Style>
                                                                <Style TargetType="ContentControl">
                                                                    <Style.Triggers>
                                                                        <MultiDataTrigger>
                                                                            <MultiDataTrigger.Conditions>
                                                                                <Condition Binding="{Binding Category}" Value="3" />
                                                                                <Condition Binding="{Binding ID, Converter={StaticResource OtherTypeToHasAmountBooleanConverter}}" Value="True" />
                                                                            </MultiDataTrigger.Conditions>
                                                                            <Setter Property="Content">
                                                                                <Setter.Value>
                                                                                    <Grid>
                                                                                        <Grid.ColumnDefinitions>
                                                                                            <ColumnDefinition Width="*" />
                                                                                            <ColumnDefinition Width="Auto" />
                                                                                        </Grid.ColumnDefinitions>

                                                                                        <controls:WheelCaptureIntegerUpDown Grid.Column="0" Minimum="1" DefaultValue="1" Height="22">
                                                                                            <controls:WheelCaptureIntegerUpDown.Text>
                                                                                                <Binding Path="Data" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                                                    <Binding.ValidationRules>
                                                                                                        <validationrules:MinMaxValidationRule Minimum="1" ValidationStep="RawProposedValue"/>
                                                                                                    </Binding.ValidationRules>
                                                                                                </Binding>
                                                                                            </controls:WheelCaptureIntegerUpDown.Text>
                                                                                        </controls:WheelCaptureIntegerUpDown>

                                                                                        <CheckBox Grid.Column="1" VerticalContentAlignment="Center" Content="Text?" IsChecked="{Binding IsCustomMystery}">
                                                                                            <CheckBox.Style>
                                                                                                <Style TargetType="CheckBox">
                                                                                                    <Style.Triggers>
                                                                                                        <DataTrigger Binding="{Binding ID}" Value="8">
                                                                                                            <Setter Property="Visibility" Value="Visible" />
                                                                                                        </DataTrigger>
                                                                                                    </Style.Triggers>

                                                                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                                                                </Style>
                                                                                            </CheckBox.Style>
                                                                                        </CheckBox>
                                                                                    </Grid>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </MultiDataTrigger>
                                                                        <MultiDataTrigger>
                                                                            <MultiDataTrigger.Conditions>
                                                                                <Condition Binding="{Binding Category}" Value="3" />
                                                                                <Condition Binding="{Binding ID}" Value="8" />
                                                                                <Condition Binding="{Binding Data}" Value="0" />
                                                                            </MultiDataTrigger.Conditions>
                                                                            <Setter Property="Content">
                                                                                <Setter.Value>
                                                                                    <Border Height="22">
                                                                                        <Grid>
                                                                                            <Grid.ColumnDefinitions>
                                                                                                <ColumnDefinition Width="*" />
                                                                                                <ColumnDefinition Width="Auto" />
                                                                                            </Grid.ColumnDefinitions>

                                                                                            <controls:TranslatedTextSelector Grid.Column="0" TextKey="{Binding ItemKey, Mode=TwoWay}" />

                                                                                            <CheckBox Grid.Column="1" VerticalContentAlignment="Center" Content="Text?" IsChecked="{Binding IsCustomMystery}" />
                                                                                        </Grid>
                                                                                    </Border>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </MultiDataTrigger>
                                                                        <MultiDataTrigger>
                                                                            <MultiDataTrigger.Conditions>
                                                                                <Condition Binding="{Binding Category}" Value="3" />
                                                                                <Condition Binding="{Binding ID, Converter={StaticResource OtherTypeToHasAmountBooleanConverter}}" Value="False" />
                                                                            </MultiDataTrigger.Conditions>
                                                                            <Setter Property="Content">
                                                                                <Setter.Value>
                                                                                    <Border Height="22">
                                                                                        <TextBlock VerticalAlignment="Center"
                                                                                                   HorizontalAlignment="Center"
                                                                                                   Text="Not used for this item"/>
                                                                                    </Border>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </MultiDataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </ContentControl.Style>
                                                        </ContentControl>
                                                    </Grid>
                                                </StackPanel>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Category}" Value="4">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <Border Height="44">
                                                    <TextBlock VerticalAlignment="Center"
                                                               HorizontalAlignment="Center"
                                                               Text="See Random Encounters"/>
                                                </Border>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>
                </StackPanel>
                <TextBlock VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Text="See Random Mystery Data">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Type}" Value="0">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                            <Setter Property="Visibility" Value="Hidden" />
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type models:MapEntity}">
        <StackPanel Orientation="Vertical">
            <StackPanel.Resources>
                <FrameworkElement x:Key="MapEventProxyElement" DataContext="{Binding}" />
            </StackPanel.Resources>
            <ContentControl Visibility="Collapsed" Content="{StaticResource MapEventProxyElement}"/>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           VerticalAlignment="Center"
                           Text="Page:"
                           FontWeight="Bold" />
                <Button Grid.Column="2" Command="{x:Static local:Constants.AddItemCommand}">
                    <Button.CommandParameter>
                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                            <Binding Path="Pages.MapEventPages" />
                            <Binding Source="{x:Static local:Constants.BlankMapEventPageCreator}" />
                            <Binding Path="Pages.SelectedEventPage" />
                        </MultiBinding>
                    </Button.CommandParameter>
                    <Rectangle Width="16" Height="16"  Fill="{StaticResource AddIcon}" />
                </Button>
            </Grid>
            <TabControl TabStripPlacement="Top"
                        ItemsSource="{Binding Pages.MapEventPages}" 
                        SelectedValue="{Binding Pages.SelectedEventPage}">
                <TabControl.ItemContainerStyle>
                    <Style TargetType="TabItem">
                        <Setter Property="Header" Value="{Binding PageNumber}"/>
                    </Style>
                </TabControl.ItemContainerStyle>
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <controls:StringEditableExpander IsExpanded="True"
                                                         DataContext="{Binding}">
                            <controls:StringEditableExpander.Header>
                                <Grid>
                                    <TextBlock HorizontalAlignment="Left" Text="{Binding PageNumber}"/>
                                    <Button HorizontalAlignment="Right" Command="{x:Static local:Constants.DuplicateItemCommand}">
                                        <Button.CommandParameter>
                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                <Binding Path="DataContext.Pages.MapEventPages" Source="{StaticResource MapEventProxyElement}" />
                                                <Binding Path="." />
                                            </MultiBinding>
                                        </Button.CommandParameter>
                                        <Rectangle Width="16" Height="16"  Fill="{StaticResource DuplicateIcon}" />
                                    </Button>
                                </Grid>
                            </controls:StringEditableExpander.Header>
                            <StackPanel Grid.IsSharedSizeScope="True"
                                        Margin="10,0,0,0"
                                        HorizontalAlignment="Stretch"
                                        Orientation="Vertical">
                                <StackPanel.Resources>
                                    <FrameworkElement x:Key="MapEventPageProxyElement" DataContext="{Binding}" />
                                </StackPanel.Resources>
                                <ContentControl Visibility="Collapsed"
                                                    Content="{StaticResource MapEventPageProxyElement}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Text="Page Number:"/>
                                    <Grid Grid.Column="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0"
                                                 Text="{Binding PageNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                            <TextBox.InputBindings>
                                                <MouseBinding Gesture="{x:Static controls:MouseWheelGesture.Down}"
                                                              Command="{x:Static local:Constants.MoveItemUpCommand}">
                                                    <MouseBinding.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                            <Binding Path="DataContext.Pages.MapEventPages" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}"/>
                                                            <Binding Path="." />
                                                        </MultiBinding>
                                                    </MouseBinding.CommandParameter>
                                                </MouseBinding>
                                                <MouseBinding Gesture="{x:Static controls:MouseWheelGesture.Up}"
                                                              Command="{x:Static local:Constants.MoveItemDownCommand}">
                                                    <MouseBinding.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                            <Binding Path="DataContext.Pages.MapEventPages" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}"/>
                                                            <Binding Path="." />
                                                        </MultiBinding>
                                                    </MouseBinding.CommandParameter>
                                                </MouseBinding>
                                            </TextBox.InputBindings>
                                        </TextBox>
                                        <StackPanel Grid.Column="1"
                                                    HorizontalAlignment="Right"
                                                    Orientation="Horizontal">
                                            <Button Command="{x:Static local:Constants.MoveItemUpCommand}">
                                                <Button.CommandParameter>
                                                    <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                        <Binding Path="DataContext.Pages.MapEventPages" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}"/>
                                                        <Binding Path="." />
                                                    </MultiBinding>
                                                </Button.CommandParameter>
                                                <Rectangle Width="16" Height="16" Fill="{StaticResource LeftArrowIcon}" />
                                            </Button>
                                            <Button Command="{x:Static local:Constants.MoveItemDownCommand}">
                                                <Button.CommandParameter>
                                                    <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                        <Binding Path="DataContext.Pages.MapEventPages" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}"/>
                                                        <Binding Path="." />
                                                    </MultiBinding>
                                                </Button.CommandParameter>
                                                <Rectangle Width="16" Height="16" Fill="{StaticResource RightArrowIcon}" />
                                            </Button>
                                            <Button Command="{x:Static local:Constants.DeleteExtraItemCommand}">
                                                <Button.CommandParameter>
                                                    <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                        <Binding Path="DataContext.Pages.MapEventPages" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}"/>
                                                        <Binding Path="." />
                                                    </MultiBinding>
                                                </Button.CommandParameter>
                                                <Rectangle Width="16" Height="16"  Fill="{StaticResource DeleteIcon}" />
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Text="Sprite:"/>
                                    <controls:SpriteSelector Grid.Column="1"
                                                             Margin="10,0"
                                                             Page="{Binding ., Mode=TwoWay}" />
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Text="Hitbox Shape:"/>
                                    <ComboBox Grid.Column="1"
                                              ItemsSource="{Binding Source={markup:EnumBindingSourceExtension {x:Type enums:HitFormType}}}"
                                              SelectedItem="{Binding HitForm, Mode=TwoWay}" />
                                </Grid>
                                <Grid>
                                    <Grid.Style>
                                        <Style TargetType="Grid">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding HitForm}" Value="Circle">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                            <Setter Property="Visibility" Value="Visible" />
                                        </Style>
                                    </Grid.Style>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Text="Hitbox Size:"/>
                                    <controls:WheelCaptureIntegerUpDown Grid.Column="1" Minimum="0">
                                        <controls:WheelCaptureIntegerUpDown.Text>
                                            <Binding Path="HitRangeWidth" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue" Minimum="0"/>
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </controls:WheelCaptureIntegerUpDown.Text>
                                    </controls:WheelCaptureIntegerUpDown>
                                    <TextBlock Grid.Column="2" Text="x"/>
                                    <controls:WheelCaptureIntegerUpDown Grid.Column="3" Minimum="0">
                                        <controls:WheelCaptureIntegerUpDown.Text>
                                            <Binding Path="HitRangeHeight" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue" Minimum="0"/>
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </controls:WheelCaptureIntegerUpDown.Text>
                                    </controls:WheelCaptureIntegerUpDown>
                                </Grid>
                                <Grid>
                                    <Grid.Style>
                                        <Style TargetType="Grid">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding HitForm}" Value="Circle">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </Style>
                                    </Grid.Style>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Text="Hitbox Radius:"/>
                                    <controls:WheelCaptureIntegerUpDown Grid.Column="1">
                                        <controls:WheelCaptureIntegerUpDown.Text>
                                            <Binding Path="HitRangeWidth" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue"/>
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </controls:WheelCaptureIntegerUpDown.Text>
                                    </controls:WheelCaptureIntegerUpDown>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Text="Hitbox Offset:"/>
                                    <controls:WheelCaptureIntegerUpDown Grid.Column="1">
                                        <controls:WheelCaptureIntegerUpDown.Text>
                                            <Binding Path="HitShiftX" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue"/>
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </controls:WheelCaptureIntegerUpDown.Text>
                                    </controls:WheelCaptureIntegerUpDown>
                                    <TextBlock Grid.Column="2" Text=","/>
                                    <controls:WheelCaptureIntegerUpDown Grid.Column="3">
                                        <controls:WheelCaptureIntegerUpDown.Text>
                                            <Binding Path="HitShiftY" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue"/>
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </controls:WheelCaptureIntegerUpDown.Text>
                                    </controls:WheelCaptureIntegerUpDown>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Text="Trigger:"/>
                                    <ComboBox Grid.Column="1"
                                              ItemsSource="{Binding Source={markup:EnumBindingSourceExtension {x:Type enums:StartTermType}}}"
                                              SelectedItem="{Binding StartTerms, Mode=TwoWay}" />
                                </Grid>
                                <StackPanel Orientation="Vertical">
                                    <StackPanel.Resources>
                                        <FrameworkElement x:Key="MovesProxyElement" DataContext="{Binding Moves}" />
                                    </StackPanel.Resources>
                                    <ContentControl Visibility="Collapsed"
                                                    Content="{StaticResource MovesProxyElement}"/>
                                    <controls:StringEditableExpander IsExpanded="True"
                                                                     Header="Movement"
                                                                     DataContext="{Binding Moves}">
                                        <StackPanel Margin="10,0,0,0"
                                                    Orientation="Vertical">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0"
                                                                Orientation="Horizontal">
                                                    <TextBlock VerticalAlignment="Center"
                                                                   Text="Move Speed:"/>
                                                    <Grid Width="16"
                                                              Height="16"
                                                              Background="{StaticResource InfoIcon}"
                                                              ToolTip="Works oddly with animated objects.">
                                                        <Grid.Style>
                                                            <Style TargetType="Grid">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding DataContext.IsCharacter, Source={StaticResource MapEventPageProxyElement}}" Value="False">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                            </Style>
                                                        </Grid.Style>
                                                    </Grid>
                                                </StackPanel>
                                                <controls:WheelCaptureIntegerUpDown Grid.Column="1" Minimum="0">
                                                    <controls:WheelCaptureIntegerUpDown.Text>
                                                        <Binding Path="DataContext.Speed" Source="{StaticResource MapEventPageProxyElement}" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                            <Binding.ValidationRules>
                                                                <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue" Minimum="0"/>
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </controls:WheelCaptureIntegerUpDown.Text>
                                                </controls:WheelCaptureIntegerUpDown>
                                            </Grid>
                                            <controls:StringEditableExpander IsExpanded="True"
                                                                             DataContext="{Binding SelectedMove}">
                                                <controls:StringEditableExpander.Style>
                                                    <Style TargetType="controls:StringEditableExpander">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DataContext.Moves.Count, Source={StaticResource MovesProxyElement}}" Value="0">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </Style>
                                                </controls:StringEditableExpander.Style>
                                                <controls:StringEditableExpander.Header>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   Text="{Binding StringValue}"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   ToolTip="{Binding StringValue}" />
                                                        <Button Grid.Column="1" Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                            <Button.CommandParameter>
                                                                <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                    <Binding Path="DataContext.Moves" Source="{StaticResource MovesProxyElement}" />
                                                                    <Binding Path="." />
                                                                </MultiBinding>
                                                            </Button.CommandParameter>
                                                            <Rectangle Width="16" Height="16"  Fill="{StaticResource DuplicateIcon}" />
                                                        </Button>
                                                    </Grid>
                                                </controls:StringEditableExpander.Header>
                                                <StackPanel Margin="10,0,0,0"
                                                            Orientation="Vertical">
                                                    <StackPanel Orientation="Vertical">
                                                        <StackPanel.Style>
                                                            <Style TargetType="StackPanel">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding DataContext.Moves.Count, Source={StaticResource MovesProxyElement}}" Value="0">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </Style>
                                                        </StackPanel.Style>
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                                                <ColumnDefinition Width="*" />
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock Grid.Column="0"
                                                                       VerticalAlignment="Center"
                                                                       Text="Type:"/>
                                                            <ComboBox Grid.Column="1"
                                                                      ItemsSource="{markup:EnumBindingSource EnumType={x:Type enums:MoveCategoryOption}}"
                                                                      SelectedValue="{Binding DataContext.SelectedMove.Category, Source={StaticResource MovesProxyElement}, Mode=TwoWay}" />
                                                        </Grid>
                                                        <ContentControl DataContext="{Binding DataContext.SelectedMove, Source={StaticResource MovesProxyElement}}">
                                                            <ContentControl.Style>
                                                                <Style TargetType="ContentControl">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Category}" Value="Walk">
                                                                            <Setter Property="Content">
                                                                                <Setter.Value>
                                                                                    <Grid>
                                                                                        <Grid.ColumnDefinitions>
                                                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn" />
                                                                                            <ColumnDefinition Width="Auto" />
                                                                                            <ColumnDefinition Width="*" />
                                                                                        </Grid.ColumnDefinitions>
                                                                                        <TextBlock Grid.Column="0"
                                                                                                   VerticalAlignment="Center"
                                                                                                   Text="Direction:" />
                                                                                        <UniformGrid Grid.Column="1" Rows="2" Columns="2"
                                                                                                     HorizontalAlignment="Right">
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleWestArrowIcon}"
                                                                                                         ToolTip="West"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.WalkLeft}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleNorthArrowIcon}"
                                                                                                         ToolTip="North"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.WalkUp}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleSouthArrowIcon}"
                                                                                                         ToolTip="South"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.WalkDown}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleEastArrowIcon}"
                                                                                                         ToolTip="East"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.WalkRight}}" />
                                                                                        </UniformGrid>
                                                                                        <StackPanel Grid.Column="2"
                                                                                                    Orientation="Vertical"
                                                                                                    VerticalAlignment="Center">
                                                                                            <TextBlock VerticalAlignment="Center"
                                                                                                       HorizontalAlignment="Center"
                                                                                                       Text="Distance:"/>
                                                                                            <controls:WheelCaptureIntegerUpDown Minimum="0">
                                                                                                <controls:WheelCaptureIntegerUpDown.Text>
                                                                                                    <Binding Path="Distance" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                                                        <Binding.ValidationRules>
                                                                                                            <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue" Minimum="0"/>
                                                                                                        </Binding.ValidationRules>
                                                                                                    </Binding>
                                                                                                </controls:WheelCaptureIntegerUpDown.Text>
                                                                                            </controls:WheelCaptureIntegerUpDown>
                                                                                        </StackPanel>
                                                                                    </Grid>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Category}" Value="Warp">
                                                                            <Setter Property="Content">
                                                                                <Setter.Value>
                                                                                    <Grid>
                                                                                        <Grid.ColumnDefinitions>
                                                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn" />
                                                                                            <ColumnDefinition Width="Auto" />
                                                                                            <ColumnDefinition Width="*" />
                                                                                        </Grid.ColumnDefinitions>
                                                                                        <TextBlock Grid.Column="0"
                                                                                                   VerticalAlignment="Center"
                                                                                                   Text="Direction:" />
                                                                                        <UniformGrid Grid.Column="1" Rows="2" Columns="2"
                                                                                                     HorizontalAlignment="Right">
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleWestArrowIcon}"
                                                                                                         ToolTip="West"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.WarpLeft}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleNorthArrowIcon}"
                                                                                                         ToolTip="North"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.WarpUp}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleSouthArrowIcon}"
                                                                                                         ToolTip="South"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.WarpDown}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleEastArrowIcon}"
                                                                                                         ToolTip="East"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.WarpRight}}" />
                                                                                        </UniformGrid>
                                                                                        <StackPanel Grid.Column="2"
                                                                                                    Orientation="Vertical"
                                                                                                    VerticalAlignment="Center">
                                                                                            <TextBlock HorizontalAlignment="Center"
                                                                                                       Text="Distance:"/>
                                                                                            <controls:WheelCaptureIntegerUpDown Minimum="0">
                                                                                                <controls:WheelCaptureIntegerUpDown.Text>
                                                                                                    <Binding Path="Distance" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                                                        <Binding.ValidationRules>
                                                                                                            <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue" Minimum="0"/>
                                                                                                        </Binding.ValidationRules>
                                                                                                    </Binding>
                                                                                                </controls:WheelCaptureIntegerUpDown.Text>
                                                                                            </controls:WheelCaptureIntegerUpDown>
                                                                                        </StackPanel>
                                                                                    </Grid>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Category}" Value="Angle">
                                                                            <Setter Property="Content">
                                                                                <Setter.Value>
                                                                                    <Grid>
                                                                                        <Grid.ColumnDefinitions>
                                                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn" />
                                                                                            <ColumnDefinition Width="Auto" />
                                                                                            <ColumnDefinition Width="*" />
                                                                                        </Grid.ColumnDefinitions>
                                                                                        <TextBlock Grid.Column="0"
                                                                                                   VerticalAlignment="Center"
                                                                                                   Text="Direction:" />
                                                                                        <UniformGrid Grid.Column="1" Rows="2" Columns="2"
                                                                                                        HorizontalAlignment="Right">
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleWestArrowIcon}"
                                                                                                         ToolTip="West"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.AngleLeft}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleNorthArrowIcon}"
                                                                                                         ToolTip="North"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.AngleUp}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleSouthArrowIcon}"
                                                                                                         ToolTip="South"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.AngleDown}}" />
                                                                                            <RadioButton Style="{StaticResource AngleIconRadioButton}"
                                                                                                         Tag="{StaticResource AngleEastArrowIcon}"
                                                                                                         ToolTip="East"
                                                                                                         IsChecked="{Binding Path=Type, Converter={StaticResource ObjectEqualityBooleanConverter}, ConverterParameter={x:Static enums:MoveType.AngleRight}}" />
                                                                                        </UniformGrid>
                                                                                    </Grid>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Category}" Value="Wait">
                                                                            <Setter Property="Content">
                                                                                <Setter.Value>
                                                                                    <Grid>
                                                                                        <Grid.ColumnDefinitions>
                                                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn" />
                                                                                            <ColumnDefinition Width="*" />
                                                                                        </Grid.ColumnDefinitions>
                                                                                        <TextBlock Grid.Column="0"
                                                                                                   VerticalAlignment="Center"
                                                                                                   Text="Ticks:" />
                                                                                        <controls:WheelCaptureIntegerUpDown Grid.Column="1"
                                                                                                            Minimum="0">
                                                                                            <controls:WheelCaptureIntegerUpDown.Text>
                                                                                                <Binding Path="Distance" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                                                    <Binding.ValidationRules>
                                                                                                        <validationrules:MinMaxValidationRule ValidationStep="RawProposedValue" Minimum="0"/>
                                                                                                    </Binding.ValidationRules>
                                                                                                </Binding>
                                                                                            </controls:WheelCaptureIntegerUpDown.Text>
                                                                                        </controls:WheelCaptureIntegerUpDown>
                                                                                    </Grid>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </ContentControl.Style>
                                                        </ContentControl>
                                                    </StackPanel>
                                                </StackPanel>
                                            </controls:StringEditableExpander>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0"
                                                           VerticalAlignment="Center"
                                                           Text="Movement:"
                                                           FontWeight="Bold" />
                                                <Button Grid.Column="1" Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                    <Button.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                            <Binding Path="Moves" />
                                                            <Binding Path="SelectedMove" />
                                                        </MultiBinding>
                                                    </Button.CommandParameter>
                                                    <Rectangle Width="16" Height="16"  Fill="{StaticResource DuplicateIcon}" />
                                                </Button>
                                                <Button Grid.Column="2" Command="{x:Static local:Constants.AddItemCommand}">
                                                    <Button.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                            <Binding Path="Moves" />
                                                            <Binding Source="{x:Static local:Constants.MoveCreator}" />
                                                            <Binding Path="SelectedMove" />
                                                        </MultiBinding>
                                                    </Button.CommandParameter>
                                                    <Rectangle Width="16" Height="16"  Fill="{StaticResource AddIcon}" />
                                                </Button>
                                            </Grid>
                                            <TextBlock HorizontalAlignment="Center"
                                                       Text="No Repeated Movement">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DataContext.Moves.Count, Source={StaticResource MovesProxyElement}}" Value="0">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <ListBox HorizontalContentAlignment="Stretch"
                                                     MaxHeight="150"
                                                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                     SelectionMode="Single"
                                                     ItemsSource="{Binding DataContext.Moves, Source={StaticResource MovesProxyElement}}"
                                                     SelectedValue="{Binding DataContext.SelectedMove, Source={StaticResource MovesProxyElement}, Delay=100}"
                                                     ItemTemplate="{StaticResource MapEventPageMovesListTemplate}"
                                                     ItemContainerStyle="{StaticResource MoveContainerStyle}"
                                                     DataContext="{Binding DataContext, Source={StaticResource MapEventPageProxyElement}}">
                                                <ListBox.Style>
                                                    <Style TargetType="ListBox">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DataContext.Moves.Count, Source={StaticResource MovesProxyElement}}" Value="0">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </Style>
                                                </ListBox.Style>
                                                <ListBox.InputBindings>
                                                    <KeyBinding Modifiers="Alt"
                                                                Key="Up"
                                                                Command="{x:Static local:Constants.MoveItemUpCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Moves.Moves" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Alt"
                                                                Key="Down"
                                                                Command="{x:Static local:Constants.MoveItemDownCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Moves.Moves" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Key="Delete"
                                                                Command="{x:Static local:Constants.DeleteItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Moves.Moves" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Shift"
                                                                Key="Delete"
                                                                Command="{x:Static local:Constants.DeleteItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Moves.Moves" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Ctrl"
                                                                Key="D"
                                                                Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Moves.Moves" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                </ListBox.InputBindings>
                                            </ListBox>
                                        </StackPanel>
                                    </controls:StringEditableExpander>
                                </StackPanel>
                                <StackPanel Orientation="Vertical">
                                    <StackPanel.Resources>
                                        <FrameworkElement x:Key="TermsProxyElement" DataContext="{Binding Terms}" />
                                    </StackPanel.Resources>
                                    <ContentControl Visibility="Collapsed"
                                                    Content="{StaticResource TermsProxyElement}"/>
                                    <controls:StringEditableExpander IsExpanded="True"
                                                                     Header="Terms"
                                                                     DataContext="{Binding Terms}">
                                        <StackPanel Margin="10,0,0,0"
                                                    Orientation="Vertical">
                                            <controls:StringEditableExpander IsExpanded="True"
                                                                             DataContext="{Binding SelectedTerm}">
                                                <controls:StringEditableExpander.Style>
                                                    <Style TargetType="controls:StringEditableExpander">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DataContext.Terms.Count, Source={StaticResource TermsProxyElement}}" Value="0">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </Style>
                                                </controls:StringEditableExpander.Style>
                                                <controls:StringEditableExpander.Header>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   Text="{Binding Name}"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   ToolTip="{Binding Name}" />
                                                        <Button Grid.Column="1" Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                            <Button.CommandParameter>
                                                                <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                    <Binding Path="DataContext.Terms" Source="{StaticResource TermsProxyElement}" />
                                                                    <Binding Path="." />
                                                                </MultiBinding>
                                                            </Button.CommandParameter>
                                                            <Rectangle Width="16" Height="16"  Fill="{StaticResource DuplicateIcon}" />
                                                        </Button>
                                                    </Grid>
                                                </controls:StringEditableExpander.Header>
                                                <StackPanel Margin="10,0,0,0"
                                                            Orientation="Vertical">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   VerticalAlignment="Center"
                                                                   Text="Type:"/>
                                                        <ComboBox Grid.Column="1"
                                                                  ItemsSource="{markup:EnumBindingSource EnumType={x:Type enums:TermCategoryOption}}"
                                                                  SelectedValue="{Binding Category, Mode=TwoWay}" />
                                                    </Grid>
                                                    <ContentControl Content="{Binding Instance}" />
                                                </StackPanel>
                                            </controls:StringEditableExpander>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0"
                                                           Text="Terms (later pages take priority):"
                                                           FontWeight="Bold" />
                                                <Button Grid.Column="1" Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                    <Button.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                            <Binding Path="Terms" />
                                                            <Binding Path="SelectedTerm" />
                                                        </MultiBinding>
                                                    </Button.CommandParameter>
                                                    <Rectangle Width="16" Height="16"  Fill="{StaticResource DuplicateIcon}" />
                                                </Button>
                                                <Button Grid.Column="2" Command="{x:Static local:Constants.AddItemCommand}">
                                                    <Button.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                            <Binding Path="Terms" />
                                                            <Binding Source="{x:Static local:Constants.TermCreator}" />
                                                            <Binding Path="SelectedTerm" />
                                                        </MultiBinding>
                                                    </Button.CommandParameter>
                                                    <Rectangle Width="16" Height="16" Fill="{StaticResource AddIcon}" />
                                                </Button>
                                            </Grid>
                                            <TextBlock HorizontalAlignment="Center"
                                               Text="No Terms">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Terms.Count}" Value="0">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <ListBox HorizontalContentAlignment="Stretch"
                                                     MaxHeight="150"
                                                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                     SelectionMode="Single"
                                                     ItemsSource="{Binding DataContext.Terms, Source={StaticResource TermsProxyElement}}"
                                                     SelectedValue="{Binding DataContext.SelectedTerm, Delay=100, Source={StaticResource TermsProxyElement}}"
                                                     ItemTemplate="{StaticResource MapEventPageTermsListTemplate}"
                                                     DataContext="{Binding DataContext, Source={StaticResource MapEventPageProxyElement}}">
                                                <ListBox.Style>
                                                    <Style TargetType="ListBox">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Terms.Terms.Count}" Value="0">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </Style>
                                                </ListBox.Style>
                                                <ListBox.Resources>
                                                    <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                                                        <Setter Property="ToolTip" Value="{Binding Name}" />
                                                    </Style>
                                                </ListBox.Resources>
                                                <ListBox.InputBindings>
                                                    <KeyBinding Modifiers="Alt"
                                                                Key="Up"
                                                                Command="{x:Static local:Constants.MoveItemUpCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Terms.Terms" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Alt"
                                                                Key="Down"
                                                                Command="{x:Static local:Constants.MoveItemDownCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Terms.Terms" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Key="Delete"
                                                                Command="{x:Static local:Constants.DeleteItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Terms.Terms" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Shift"
                                                                Key="Delete"
                                                                Command="{x:Static local:Constants.DeleteItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Terms.Terms" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Ctrl"
                                                                Key="D"
                                                                Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Terms.Terms" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                </ListBox.InputBindings>
                                            </ListBox>
                                        </StackPanel>
                                    </controls:StringEditableExpander>
                                </StackPanel>
                                <StackPanel Orientation="Vertical">
                                    <StackPanel.Resources>
                                        <FrameworkElement x:Key="EventsProxyElement" DataContext="{Binding Events}" />
                                    </StackPanel.Resources>
                                    <ContentControl Visibility="Collapsed"
                                                    Content="{StaticResource EventsProxyElement}"/>
                                    <controls:StringEditableExpander IsExpanded="True"
                                                                     Header="Events"
                                                                     DataContext="{Binding Events}">
                                        <StackPanel Margin="10,0,0,0"
                                                    Orientation="Vertical">
                                            <controls:StringEditableExpander IsExpanded="True"
                                                                             DataContext="{Binding SelectedEvent}">
                                                <controls:StringEditableExpander.Style>
                                                    <Style TargetType="controls:StringEditableExpander">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DataContext.Events.Count, Source={StaticResource EventsProxyElement}}" Value="0">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </Style>
                                                </controls:StringEditableExpander.Style>
                                                <controls:StringEditableExpander.Header>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0"
                                                                   Text="{Binding Name}"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   ToolTip="{Binding Name}" />
                                                        <Button Grid.Column="1" Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                            <Button.CommandParameter>
                                                                <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                    <Binding Path="DataContext.Events" Source="{StaticResource EventsProxyElement}" />
                                                                    <Binding Path="." />
                                                                </MultiBinding>
                                                            </Button.CommandParameter>
                                                            <Rectangle Width="16" Height="16"  Fill="{StaticResource DuplicateIcon}" />
                                                        </Button>
                                                    </Grid>
                                                </controls:StringEditableExpander.Header>
                                                <StackPanel Orientation="Vertical">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" SharedSizeGroup="ObjectLabelColumn"/>
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>
                                                        <DockPanel Grid.Column="0">
                                                            <TextBlock DockPanel.Dock="Left"
                                                                       VerticalAlignment="Center"
                                                                       Text="Type:"/>
                                                            <Grid DockPanel.Dock="Right"
                                                                  Width="16"
                                                                  Height="16"
                                                                  Background="{StaticResource InfoIcon}"
                                                                  ToolTip="{Binding Instance.Info}"/>
                                                        </DockPanel>
                                                        <ComboBox Grid.Column="1"
                                                                  ItemsSource="{markup:EnumBindingSource EnumType={x:Type enums:EventCategoryOption}}"
                                                                  SelectedValue="{Binding Category, Mode=TwoWay}" />
                                                    </Grid>
                                                    <ContentControl Content="{Binding Instance}" />
                                                </StackPanel>
                                            </controls:StringEditableExpander>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <Expander Grid.Column="0"
                                                          Header="Events:"
                                                          IsExpanded="{Binding DataContext.EventsExpanded, Source={StaticResource MapEventPageProxyElement}}"
                                                          FontWeight="Bold" />
                                                <Button Grid.Column="1" Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                    <Button.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                            <Binding Path="Events" />
                                                            <Binding Path="SelectedEvent" />
                                                        </MultiBinding>
                                                    </Button.CommandParameter>
                                                    <Rectangle Width="16" Height="16"  Fill="{StaticResource DuplicateIcon}" />
                                                </Button>
                                                <Button Grid.Column="2" Command="{x:Static local:Constants.AddItemCommand}">
                                                    <Button.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                            <Binding Path="Events" />
                                                            <Binding Source="{x:Static local:Constants.EventCreator}" />
                                                            <Binding Path="SelectedEvent" />
                                                        </MultiBinding>
                                                    </Button.CommandParameter>
                                                    <Rectangle Width="16" Height="16" Fill="{StaticResource AddIcon}" />
                                                </Button>
                                            </Grid>
                                            <TextBlock HorizontalAlignment="Center"
                                               Text="No Events">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Events.Count}" Value="0">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <ListBox HorizontalContentAlignment="Stretch"
                                                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                     SelectionMode="Single"
                                                     ItemsSource="{Binding DataContext.Events, Source={StaticResource EventsProxyElement}}"
                                                     SelectedValue="{Binding DataContext.SelectedEvent, Delay=100, Source={StaticResource EventsProxyElement}}"
                                                     ItemTemplate="{StaticResource MapEventPageEventsListTemplate}"
                                                     DataContext="{Binding DataContext, Source={StaticResource MapEventPageProxyElement}}">
                                                <ListBox.Style>
                                                    <Style TargetType="ListBox">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Events.Events.Count}" Value="0">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding EventsExpanded}" Value="False">
                                                                <Setter Property="MaxHeight" Value="150"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </Style>
                                                </ListBox.Style>
                                                <ListBox.Resources>
                                                    <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                                                        <Setter Property="ToolTip" Value="{Binding Name}" />
                                                    </Style>
                                                </ListBox.Resources>
                                                <ListBox.InputBindings>
                                                    <KeyBinding Modifiers="Alt"
                                                                Key="Up"
                                                                Command="{x:Static local:Constants.MoveItemUpCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Events.Events" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Alt"
                                                                Key="Down"
                                                                Command="{x:Static local:Constants.MoveItemDownCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Events.Events" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Key="Delete"
                                                                Command="{x:Static local:Constants.DeleteItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Events.Events" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Shift"
                                                                Key="Delete"
                                                                Command="{x:Static local:Constants.DeleteItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Events.Events" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                    <KeyBinding Modifiers="Ctrl"
                                                                Key="D"
                                                                Command="{x:Static local:Constants.DuplicateItemCommand}">
                                                        <KeyBinding.CommandParameter>
                                                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                                                <Binding Path="Events.Events" />
                                                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ListBox}" />
                                                            </MultiBinding>
                                                        </KeyBinding.CommandParameter>
                                                    </KeyBinding>
                                                </ListBox.InputBindings>
                                            </ListBox>
                                        </StackPanel>
                                    </controls:StringEditableExpander>
                                </StackPanel>
                            </StackPanel>
                        </controls:StringEditableExpander>
                    </DataTemplate>
                </TabControl.ContentTemplate>
                <TabControl.InputBindings>
                    <KeyBinding Modifiers="Alt"
                                Key="Left"
                                Command="{x:Static local:Constants.MoveItemUpCommand}">
                        <KeyBinding.CommandParameter>
                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                <Binding Path="Pages.MapEventPages" />
                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}" />
                            </MultiBinding>
                        </KeyBinding.CommandParameter>
                    </KeyBinding>
                    <KeyBinding Modifiers="Alt"
                                Key="Right"
                                Command="{x:Static local:Constants.MoveItemDownCommand}">
                        <KeyBinding.CommandParameter>
                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                <Binding Path="Pages.MapEventPages" />
                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}" />
                            </MultiBinding>
                        </KeyBinding.CommandParameter>
                    </KeyBinding>
                    <KeyBinding Key="Delete"
                                Command="{x:Static local:Constants.DeleteItemCommand}">
                        <KeyBinding.CommandParameter>
                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                <Binding Path="Pages.MapEventPages" />
                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}" />
                            </MultiBinding>
                        </KeyBinding.CommandParameter>
                    </KeyBinding>
                    <KeyBinding Modifiers="Shift"
                                Key="Delete"
                                Command="{x:Static local:Constants.DeleteItemCommand}">
                        <KeyBinding.CommandParameter>
                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                <Binding Path="Pages.MapEventPages" />
                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}" />
                            </MultiBinding>
                        </KeyBinding.CommandParameter>
                    </KeyBinding>
                    <KeyBinding Modifiers="Ctrl"
                                Key="D"
                                Command="{x:Static local:Constants.DuplicateItemCommand}">
                        <KeyBinding.CommandParameter>
                            <MultiBinding Converter="{StaticResource BindingsToArrayMultiConverter}">
                                <Binding Path="Pages.MapEventPages" />
                                <Binding Path="SelectedValue" RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=TabControl}" />
                            </MultiBinding>
                        </KeyBinding.CommandParameter>
                    </KeyBinding>
                </TabControl.InputBindings>
            </TabControl>
        </StackPanel>
    </DataTemplate>
</ResourceDictionary>